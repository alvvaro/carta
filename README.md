# Carta

An alternative frontend for RTVE Play. It is deployed as an SPA that consumes RTVE Play's public API (`https://api.rtve.es/api/`).

## Features

- Simpler, quicker, lighter user interface
- Native OS media player
- No ads
- No user account prompt
- No telemetry

### Limitations

Some resources may not play due to DRM limitations. At the top of a resource page you will find options to switch to RTVE's player –via an iframe– and to open the corresponding RTVE Play page on a new tab.

Your web browser needs to be able to play DRM-enabled media.

Some features are not yet implemented, refer to the next section.

### Roadmap

- [ ] Video subtitles
- [ ] Playing audio (radio) resources
- [ ] Advanced search
- [ ] Runtime type-checking with [Zod](https://zod.dev/)

## Tech Stack

- [React](https://react.dev/), UI composition
- [TypeScript](https://www.typescriptlang.org/), static type-checking
- [Vite](https://vite.dev/), bundling and dev environment
- [SWR](https://swr.vercel.app/), data fetching
- [Tailwind CSS](https://tailwindcss.com/), styling
- [Wouter](https://github.com/molefrog/wouter), SPA routing
- [Shaka](https://github.com/shaka-project/shaka-player), video player and DRM management
- [Quicktype](https://quicktype.io/), JSON to TypeScript converter

## Development

Use Node >22. Fetch dependencies using Yarn 4 (might need to enable `corepack`):

```bash
yarn
```

Then run the development server:

```bash
yarn start
```

or build the statics:
```bash
yarn build
```

Entrypoint is `/src/main.tsx`

### Types

RTVE does not provide a public document explaining their API structure (Swagger or other), so types have to be generated by sampling their API routes.

You may use the Node script at `/quicktype.ts` to draft a new TypeScript file.

Edit the necessary inputs at the beggining of the file:

```json
{
  "ENTRYPOINT": "string - URL pattern to fetch. '{%%}' will be replaced with decreasing numbers, finishing with 1. If ENTRYPOINT_FILE is truthy, this value is ignored",
  "ENTRYPOINT_FILE": "string - Local files to convert. Use the '{%%}' placeholder to include all files with a numeric part. If this value is truthy, ENTRYPOINT is ignored",
  "MAX_ITERATIONS": "number - When using ENTRYPOINT, max amount of URLs to fetch",
  "NAME": "string - Name of the final interface",
  "FILE_PATH": "string - Relative path to save the generated definitions to"
}
```

and then run the script using Node:

```bash
node --experimental-strip-types quicktype.ts
```

This will generate a `.ts` file you may then cleanup and incorporate into the rest of definitions at `src/types/rtve`.
